

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Azure Conditional Authentication Factors with SafeNet Trusted Access &mdash; SafeNet Trusted Access 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> SafeNet Trusted Access
          

          
            
            <img src="_static/thales_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Azure Conditional Authentication Factors with SafeNet Trusted Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-steps">Configuration Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#safenet-trusted-access-configuration">SafeNet Trusted Access configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-new-azure-conditional-authentication-factors-application">Create new Azure Conditional Authentication Factors Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Configure STA Authentication Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#azure-active-directory-configuration">Azure Active Directory configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-custom-control">Create a new Custom Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-policy-to-apply-the-new-custom-control">Create a new Policy to apply the new Custom Control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-solution">Testing the solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-overview-video">Solution Overview Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">SafeNet Trusted Access</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Azure Conditional Authentication Factors with SafeNet Trusted Access</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="azure-conditional-authentication-factors-with-safenet-trusted-access">
<h1>Azure Conditional Authentication Factors with SafeNet Trusted Access<a class="headerlink" href="#azure-conditional-authentication-factors-with-safenet-trusted-access" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Azure Conditional Authentication Factors (Custom Controls) allows extending the Azure Active Directory authentication with a third party authentication provider, using OIDC protocol.
When using custom controls, the users are redirected to SafeNet Trusted Access to satisfy authentication requirements outside of Azure Active Directory. To satisfy this control, a user’s browser is redirected to SafeNet Trusted Access, performs any required authentication, and is then redirected back to Azure Active Directory. Azure Active Directory verifies the response and, if the user was successfully authenticated or validated, the user continues in the Conditional Access flow.</p>
<div><img height="320" src="_images/blockdiag-b1c711de770de81bc462ec6c8cbe80873f67b266.png" width="1720" /></div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information about Microsoft Conditional Authentication Factors (Custom Controls), please visit <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/controls">https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/controls</a></p>
</div>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Existing Azure Active Directory domain with <strong>Premium P1 subscription</strong> - (<strong>P1</strong> or above is required for Conditional Access)</p></li>
<li><p>Test User synchronized to both AAD and STA - (matching UPN)</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuration-steps">
<h2>Configuration Steps<a class="headerlink" href="#configuration-steps" title="Permalink to this headline">¶</a></h2>
<p>The configuration requires the following steps:</p>
<blockquote>
<div><p><strong>In SafeNet Trusted Access</strong></p>
<ul class="simple">
<li><p>Add <strong>Azure Conditional Authentication Factors</strong> application in STA</p></li>
<li><p>Copy the generated <a class="reference internal" href="#json"><span class="std std-ref">JSON</span></a> code</p></li>
<li><p>Assign the application to users</p></li>
<li><p><a class="reference internal" href="#configure-sta-authentication-policy">Configure STA Authentication Policy</a></p></li>
</ul>
<p><strong>In Azure Active Directory</strong></p>
<ul class="simple">
<li><p>Create <strong>Custom Control</strong> using the provided <strong>JSON</strong> code</p></li>
<li><p>Create <strong>Conditional Access</strong> policy to use the new <strong>Custom Control</strong></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="safenet-trusted-access-configuration">
<h2>SafeNet Trusted Access configuration<a class="headerlink" href="#safenet-trusted-access-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open SafeNet Trusted Access Console (you can use the following direct links based on your availability zone, opens in a new tab)</p>
<p><a href="https://sta.us.safenetid.com" target="_blank">US Zone SafeNet Trusted Access Console</a></p>
<blockquote>
<div></div></blockquote>
<p><a href="https://sta.eu.safenetid.com" target="_blank">EU Zone SafeNet Trusted Access Console</a></p>
<p><a href="https://sta.safenetid.com" target="_blank">Classic Zone SafeNet Trusted Access Console</a></p>
</div>
<div class="section" id="create-new-azure-conditional-authentication-factors-application">
<h3>Create new Azure Conditional Authentication Factors Application<a class="headerlink" href="#create-new-azure-conditional-authentication-factors-application" title="Permalink to this headline">¶</a></h3>
<p>In the STA Console create a new application by following these steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Go to the <span class="guilabel">Applications</span> tab</p></li>
<li><p>Click <span class="guilabel">+</span> and search for <strong>Azure Conditional Authentication Factors</strong>, click it to select</p></li>
<li><p><em>(Optional)</em> Rename the Application to a desired application name</p></li>
<li><p>Click <span class="guilabel">Add</span> to add the application to your library</p></li>
</ol>
</div></blockquote>
<p id="json">The application is added and <strong>JSON</strong> code is generated:</p>
<a class=""
               data-lightbox="group-d985dbfc-2544-4217-b2eb-f6223c3128a7"
               href="_images/aad_add.png"
               title=""
               data-title=""
               ><img src="_images/aad_add.png"
                     class="align-center"
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>Click <span class="guilabel">Copy</span> to copy the <strong>JSON</strong> code or <span class="guilabel">Email</span> to open a new email with <strong>JSON</strong> code pasted in and ready to send</p>
<p>Click <span class="guilabel">Assign</span> to assign the created application to the required users</p>
<a class=""
               data-lightbox="group-037dd8d7-e081-4d8e-8c73-9259603c7a29"
               href="_images/assign.png"
               title=""
               data-title=""
               ><img src="_images/assign.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>Click <span class="guilabel">Save Configuration</span> to save the application</p>
</div>
<div class="section" id="id1">
<h3><span class="target" id="configure-sta-authentication-policy">Configure STA Authentication Policy</span><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In the STA Console, create a new Access Policy for Azure Conditional Authentication Factors application by following these steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Go to the <span class="guilabel">Policies</span> tab</p></li>
<li><p>Click <span class="guilabel">+</span> to add a new Policy</p></li>
<li><p>Name the new Policy, <em>for example Azure Custom Control</em></p></li>
</ol>
<ul class="simple">
<li><p><strong>Polcy Scope</strong></p>
<ol class="arabic simple">
<li><p>Under <strong>Users</strong>, click <span class="guilabel">All Users</span> to apply to all users or <span class="guilabel">Any of these User Groups:</span> to apply to specifc User Groups</p></li>
<li><p>Under <strong>Applications</strong>, click <span class="guilabel">Any of these Applications</span>, click in the field and select <strong>Azure Conditional Authentication Factors</strong> application</p></li>
</ol>
</li>
<li><p><strong>Default Requirements</strong></p>
<ol class="arabic simple">
<li><p>Select the desired authentication method <em>for example</em> <span class="guilabel">Token Based Authentication (OTP)</span> and <span class="guilabel">Every access attempt</span></p></li>
</ol>
</li>
<li><p>Click <span class="guilabel">Save</span> to save the new Policy</p></li>
</ul>
</div></blockquote>
<a class=""
               data-lightbox="group-13393958-4359-48a9-80a4-b123c5b060ee"
               href="_images/policy.png"
               title=""
               data-title=""
               ><img src="_images/policy.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>The STA configuration is complete</p>
</div>
</div>
<div class="section" id="azure-active-directory-configuration">
<h2>Azure Active Directory configuration<a class="headerlink" href="#azure-active-directory-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Open Azure Active Directory console, <span class="menuselection">Security ‣ Custom Controls</span> (you can use the following direct link, opens in a new tab)</p>
<p><a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/CustomControls" target="_blank">Azure Active Directory Console - Custom Controls</a></p>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="create-a-new-custom-control">
<h3>Create a new Custom Control<a class="headerlink" href="#create-a-new-custom-control" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li><p>Click <span class="guilabel">+ New custom control</span></p></li>
<li><p>Delete the example JSON code provided from the text box</p></li>
<li><p>Paste the SafeNet Trusted Access <a class="reference internal" href="#json"><span class="std std-ref">JSON</span></a>, created in <a class="reference internal" href="#json"><span class="std std-ref">this section</span></a>, into the text box</p></li>
<li><p>Click <span class="guilabel">Create</span> to save the Configuration</p></li>
</ol>
</div></blockquote>
<a class=""
               data-lightbox="group-2e47da08-d914-42fc-9c16-e2a5f999da51"
               href="_images/aad_cc.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p id="custom-control">The new Custom Control is created with a default name <strong>SafeNet MFA</strong></p>
<a class=""
               data-lightbox="group-bf9c1698-e5d3-4c87-a23e-1aff5feb31f5"
               href="_images/aad_cc_added.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_added.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="create-a-new-policy-to-apply-the-new-custom-control">
<h3>Create a new Policy to apply the new Custom Control<a class="headerlink" href="#create-a-new-policy-to-apply-the-new-custom-control" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li><p>Click <span class="guilabel">Policies</span></p></li>
<li><p>Click <span class="guilabel">+ New Policy</span></p></li>
<li><p>Name the new policy, <em>for example Custom MFA for Cloud Applications</em></p></li>
</ol>
<ul class="simple">
<li><p><strong>Assignments</strong></p>
<ol class="arabic simple">
<li><p>Under <strong>Users and Groups</strong>, click <span class="guilabel">0 users and groups selected</span> to open the user selection blade</p></li>
<li><p>Click <span class="guilabel">All users</span> to apply the policy to all users, or <span class="guilabel">Select users and groups</span> to apply the policy to specific users and groups</p></li>
</ol>
</li>
</ul>
<a class=""
               data-lightbox="group-27bd9001-8feb-4dd8-97e8-1765b4ba5096"
               href="_images/aad_cc_users.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_users.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div></blockquote>
<ul id="apps">
<li><p>Under <strong>Cloud apps or actions</strong>, click <span class="guilabel">No cloud apps or actions selected</span> to open the application selection blade</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Click <span class="guilabel">All apps</span>, to apply the policy to all applications, or <span class="guilabel">Select apps</span> to apply the policy to specific applications</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<a class=""
               data-lightbox="group-1bf7cac6-8f1f-485c-9896-ad108c98f918"
               href="_images/aad_cc_apps.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_apps.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><ul>
<li><p>Under <strong>Conditions</strong>, click <span class="guilabel">0 conditions selected</span> to open the conditions blade</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Select the conditions that are required for your policy</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<a class=""
               data-lightbox="group-6a31bd58-514c-4475-bf1d-d9679342e9c8"
               href="_images/aad_cc_conditions.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_conditions.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><ul>
<li><p><strong>Access Controls</strong></p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Under <strong>Grant</strong>, click <span class="guilabel">0 controls selected</span> to open the grant selection blade</p></li>
<li><p>Make sure <strong>Grant access</strong> is selected and click <span class="guilabel">SafeNet MFA</span> to select the Custom Control created in <a class="reference internal" href="#custom-control"><span class="std std-ref">this section</span></a>, click <span class="guilabel">Select</span></p></li>
</ol>
</div></blockquote>
</li>
</ul>
<a class=""
               data-lightbox="group-4aeb257f-9e98-41cf-a640-a33ebb033379"
               href="_images/aad_cc_grant.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_grant.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><ul>
<li><p><strong>Enable Policy</strong></p>
<blockquote>
<div><ol class="arabic simple">
<li><p>To save the policy in <strong>Report only mode</strong>, click <span class="guilabel">Report-only</span>, to save and enable the policy, click <span class="guilabel">On</span></p></li>
<li><p>Click <span class="guilabel">Create</span> to save and create your policy</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<a class=""
               data-lightbox="group-ae4ccb5b-7d83-4ed2-8193-023b96700b9b"
               href="_images/aad_cc_create.png"
               title=""
               data-title=""
               ><img src="_images/aad_cc_create.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>The new policy is created</p>
</div>
</div>
<div class="section" id="testing-the-solution">
<h2>Testing the solution<a class="headerlink" href="#testing-the-solution" title="Permalink to this headline">¶</a></h2>
<p>To test the integration, open a browser and navigate to the Azure application selected in <a class="reference internal" href="#apps"><span class="std std-ref">this section</span></a>, click <span class="guilabel">Sign in</span></p>
<a class=""
               data-lightbox="group-3e533652-2446-4918-8ae3-43d30b8dbd0b"
               href="_images/aad_office.png"
               title=""
               data-title=""
               ><img src="_images/aad_office.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>You are redirected to Azure Active Directory sign in page, type in your Azure Active Directory username and click <span class="guilabel">Next</span></p>
<a class=""
               data-lightbox="group-b900b92a-0e40-4491-a9b2-72f3d11b5329"
               href="_images/office_user.png"
               title=""
               data-title=""
               ><img src="_images/office_user.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>Type in your Azure Active Directory password and click <span class="guilabel">Sign in</span></p>
<a class=""
               data-lightbox="group-18ed5810-cab7-4abb-82ab-cd4630bc1c96"
               href="_images/office_pass.png"
               title=""
               data-title=""
               ><img src="_images/office_pass.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>You are redirected to SafeNet Trusted Access authentication page, type in your OTP (using any OTP authenticators assigned to your user) and click <span class="guilabel">LOGIN</span></p>
<a class=""
               data-lightbox="group-f0d28fab-1992-4f50-9ae9-b08080587271"
               href="_images/sta_login.png"
               title=""
               data-title=""
               ><img src="_images/sta_login.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a><p>You are redirected back to your application and logged in</p>
<a class=""
               data-lightbox="group-b5947a1c-d31d-4175-b504-d91adad81f78"
               href="_images/office.png"
               title=""
               data-title=""
               ><img src="_images/office.png"
                     class=""
                     width="100%"
                     height="auto"
                     alt=""/>
                </a></div>
<div class="section" id="solution-overview-video">
<h2>Solution Overview Video<a class="headerlink" href="#solution-overview-video" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>With Custom Controls implementation, the username matching between Azure Active Directory and SafeNet Trusted Access is based on <strong>UPN</strong>.
Currently, the only way to get the user’s UPN into SafeNet Trusted Access is through synchronization from Active Directory, using SafeNet Trusted Access Synchronization Agent. In case the user identifictaion fails after redirect to SafeNet Trusted Access, verify the <strong>UPN</strong> matches between Azure Active Dirctory and synchronized user in SafeNet Trusted Access.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Alex Basin.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>